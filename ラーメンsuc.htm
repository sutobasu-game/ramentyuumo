<!DOCTYPE html>
<html lang="ja">
<head>
<title>注文入力（店員用）</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body{
    margin:0;
    background:#f6f6fb;
    font-family: system-ui, sans-serif;
  }
  .frame{
    max-width:900px;
    margin:auto;
    padding:16px;
    border:4px solid #7b4dff;
    border-radius:16px;
    background:#fff;
  }
  h1{
    text-align:center;
    color:#7b4dff;
  }

  .row{
    margin-bottom:12px;
  }

  input[type=text]{
    width:100%;
    padding:10px;
    font-size:18px;
    border-radius:10px;
    border:2px solid #7b4dff;
  }

  .nums{
    display:grid;
    grid-template-columns: repeat(8,1fr);
    gap:6px;
    margin:10px 0;
  }
  .nums input{
    text-align:center;
    font-size:20px;
  }

  .men{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
  }
  .men button{
    padding:10px;
    border:none;
    border-radius:10px;
    font-size:16px;
    cursor:pointer;
    background:#ddd;
  }
  .men button.active{
    background:#7b4dff;
    color:#fff;
  }

  .keypad{
    display:grid;
    grid-template-columns: repeat(3,1fr);
    gap:8px;
    margin-top:10px;
  }
  .keypad button{
    padding:14px;
    font-size:22px;
    border:none;
    border-radius:12px;
    background:#eee;
    cursor:pointer;
  }

  .submit{
    margin-top:16px;
    width:100%;
    padding:16px;
    font-size:20px;
    border:none;
    border-radius:14px;
    background:#ff4d4d;
    color:#fff;
    cursor:pointer;
  }
</style>
</head>

<body>
<div class="frame">
  <h1>?? 注文入力（店員用）</h1>

  <div class="row">
    <input id="name" placeholder="お客さんの名前">
  </div>

  <div class="nums" id="nums"></div>

  <div class="row men">
    <button data-men="普通" data-g="300">普通 300g</button>
    <button data-men="小" data-g="200">小 200g</button>
    <button data-men="大" data-g="500">大 500g</button>
    <button data-men="半分" data-g="150">半分 150g</button>
    <button data-men="1/3" data-g="100">1/3 100g</button>
  </div>

  <div class="keypad" id="pad"></div>

  <button class="submit" id="submit">注文確定</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, set, push, remove } 
  from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAIcXnxMhmjY_90dqRubGk4waqaehpsjhI",
  authDomain: "ra-men-43fab.firebaseapp.com",
  databaseURL: "https://ra-men-43fab-default-rtdb.firebaseio.com",
  projectId: "ra-men-43fab",
  storageBucket: "ra-men-43fab.firebasestorage.app",
  messagingSenderId: "451621666181",
  appId: "1:451621666181:web:21ed43c38173c22dca18ec"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let nums = Array(8).fill("");
let men = "";
let gram = 0;

/* 数字枠 */
const numsBox = document.getElementById("nums");
nums.forEach((_,i)=>{
  const inp = document.createElement("input");
  inp.disabled = true;
  numsBox.appendChild(inp);
});

/* テンキー */
const pad = document.getElementById("pad");
[1,2,3,4,5,6,7,8,9,0].forEach(n=>{
  const b = document.createElement("button");
  b.textContent = n;
  b.onclick = ()=>inputNum(n);
  pad.appendChild(b);
});
const del = document.createElement("button");
del.textContent = "←";
del.onclick = delNum;
pad.appendChild(del);

/* 入力処理 */
function inputNum(n){
  const i = nums.findIndex(v=>v==="");
  if(i === -1) return;
  nums[i] = n;
  update();
}
function delNum(){
  for(let i=7;i>=0;i--){
    if(nums[i] !== ""){
      nums[i] = "";
      break;
    }
  }
  update();
}

/* 麺量 */
document.querySelectorAll(".men button").forEach(b=>{
  b.onclick = ()=>{
    document.querySelectorAll(".men button").forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
    men = b.dataset.men;
    gram = Number(b.dataset.g);
    sync();
  };
});

/* 表示更新 */
function update(){
  [...numsBox.children].forEach((el,i)=>el.value = nums[i]);
  sync();
}

/* 客側にリアルタイム送信 */
function sync(){
  set(ref(db,"currentOrder"),{
    name: document.getElementById("name").value,
    number: nums.join(""),
    men, gram
  });
}

/* 名前変更も即反映 */
document.getElementById("name").addEventListener("input",sync);

/* 注文確定 */
document.getElementById("submit").onclick = ()=>{
  if(nums.includes("") || !men) return alert("未入力があります");

  push(ref(db,"orders"),{
    name: document.getElementById("name").value,
    number: nums.join(""),
    men, gram,
    time: Date.now()
  });

  remove(ref(db,"currentOrder"));

  nums = Array(8).fill("");
  men = ""; gram = 0;
  document.getElementById("name").value = "";
  document.querySelectorAll(".men button").forEach(x=>x.classList.remove("active"));
  update();
};
</script>
</body>
</html>
